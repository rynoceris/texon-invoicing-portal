{"ast":null,"code":"import React,{useState,useEffect}from'react';import EmailModal from'./EmailModal';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API_BASE='/texon-invoicing-portal/api';function InvoiceDashboard(_ref){var _pagination$total_cou,_notesModal$invoice;let{token}=_ref;const[statistics,setStatistics]=useState(null);const[unpaidInvoices,setUnpaidInvoices]=useState([]);const[pagination,setPagination]=useState(null);const[isLoading,setIsLoading]=useState(false);const[error,setError]=useState('');const[dateRange,setDateRange]=useState({start:'2024-01-01',end:new Date().toISOString().split('T')[0]});const[currentPage,setCurrentPage]=useState(1);const[sortConfig,setSortConfig]=useState({column:'placedon',order:'desc'});const[itemsPerPage,setItemsPerPage]=useState(25);const[settings,setSettings]=useState({});const[filters,setFilters]=useState({daysOutstanding:'all',// all, over90, 60to90, 30to60, under30\nsearchTerm:'',searchType:'all'// all, order_number, customer\n});const[notesModal,setNotesModal]=useState({isOpen:false,invoice:null,userNotes:[],brightpearlNotes:[],isLoading:false,newNote:''});// Email functionality state\nconst[emailModal,setEmailModal]=useState({isOpen:false,invoice:null,emailType:'invoice'// 'invoice' or 'reminder'\n});const[userEmailSettings,setUserEmailSettings]=useState(null);// Load invoice statistics\nconst loadStatistics=async()=>{try{const response=await fetch(`${API_BASE}/invoices/statistics?start_date=${dateRange.start}&end_date=${dateRange.end}`,{headers:{'Authorization':`Bearer ${token}`}});if(response.ok){const data=await response.json();if(data.success){setStatistics(data.statistics);}}}catch(error){console.error('Error loading statistics:',error);}};// Load unpaid invoices with pagination and sorting\nconst loadUnpaidInvoices=async function(){let page=arguments.length>0&&arguments[0]!==undefined?arguments[0]:currentPage;let sort=arguments.length>1&&arguments[1]!==undefined?arguments[1]:sortConfig;let currentFilters=arguments.length>2&&arguments[2]!==undefined?arguments[2]:filters;setIsLoading(true);setError('');try{const params=new URLSearchParams({start_date:dateRange.start,end_date:dateRange.end,page:page,limit:itemsPerPage,sort_by:sort.column,sort_order:sort.order});// Add filter parameters\nif(currentFilters.daysOutstanding!=='all'){params.append('days_outstanding_filter',currentFilters.daysOutstanding);}if(currentFilters.searchTerm.trim()){params.append('search_term',currentFilters.searchTerm.trim());params.append('search_type',currentFilters.searchType);}const response=await fetch(`${API_BASE}/invoices/unpaid?${params}`,{headers:{'Authorization':`Bearer ${token}`}});if(response.ok){const data=await response.json();if(data.success){setUnpaidInvoices(data.invoices);setPagination(data.pagination);}else{setError(data.error||'Failed to load invoices');}}else{setError('Server error loading invoices');}}catch(error){setError('Network error loading invoices');}setIsLoading(false);};// Load settings to get per-page configuration\nconst loadSettings=async()=>{try{const response=await fetch(`${API_BASE}/settings`,{headers:{'Authorization':`Bearer ${token}`}});if(response.ok){const data=await response.json();setSettings(data);// Update items per page from settings\nconst perPage=parseInt(data.invoices_per_page)||25;setItemsPerPage(perPage);return perPage;// Return the per page value so we can use it immediately\n}}catch(error){console.error('Error loading settings:',error);// Keep default value if settings load fails\n}return 25;// Return default if loading fails\n};// Load data when component mounts or parameters change\nuseEffect(()=>{const initializeData=async()=>{const perPage=await loadSettings();// Wait for settings to load first\nloadStatistics();// Load invoices with the correct per-page setting\nloadUnpaidInvoices(currentPage,sortConfig,filters);};initializeData();},[dateRange]);// Reload invoices when items per page changes\nuseEffect(()=>{if(itemsPerPage!==25){// Only reload if different from default\nsetCurrentPage(1);// Reset to first page\nloadUnpaidInvoices(1,sortConfig);}},[itemsPerPage]);// Reload invoices when filters change\nuseEffect(()=>{setCurrentPage(1);// Reset to first page when filters change\nloadUnpaidInvoices(1,sortConfig,filters);},[filters]);// Handle date range changes\nconst handleDateRangeChange=(field,value)=>{setDateRange(prev=>({...prev,[field]:value}));setCurrentPage(1);// Reset to first page when date range changes\n};// Handle page changes\nconst handlePageChange=newPage=>{setCurrentPage(newPage);loadUnpaidInvoices(newPage,sortConfig,filters);};// Handle sorting\nconst handleSort=column=>{const newOrder=sortConfig.column===column&&sortConfig.order==='desc'?'asc':'desc';const newSortConfig={column,order:newOrder};setSortConfig(newSortConfig);setCurrentPage(1);// Reset to first page when sorting changes\nloadUnpaidInvoices(1,newSortConfig,filters);};// Handle filter changes\nconst handleFilterChange=(filterType,value)=>{setFilters(prev=>({...prev,[filterType]:value}));};// Clear all filters\nconst clearFilters=()=>{setFilters({daysOutstanding:'all',searchTerm:'',searchType:'all'});};// Notes functionality\nconst openNotesModal=async invoice=>{setNotesModal(prev=>({...prev,isOpen:true,invoice:invoice,isLoading:true,userNotes:[],brightpearlNotes:[],newNote:''}));// Load notes for this order\ntry{const response=await fetch(`${API_BASE}/orders/${invoice.id}/notes`,{headers:{'Authorization':`Bearer ${token}`}});if(response.ok){const data=await response.json();if(data.success){setNotesModal(prev=>({...prev,userNotes:data.userNotes||data.notes||[],// Handle both old and new API format\nbrightpearlNotes:data.brightpearlNotes||[],isLoading:false}));}}}catch(error){console.error('Error loading notes:',error);setNotesModal(prev=>({...prev,isLoading:false}));}};const closeNotesModal=()=>{setNotesModal({isOpen:false,invoice:null,userNotes:[],brightpearlNotes:[],isLoading:false,newNote:''});};const addNote=async()=>{if(!notesModal.newNote.trim())return;try{const response=await fetch(`${API_BASE}/orders/${notesModal.invoice.id}/notes`,{method:'POST',headers:{'Authorization':`Bearer ${token}`,'Content-Type':'application/json'},body:JSON.stringify({note:notesModal.newNote.trim()})});if(response.ok){const data=await response.json();if(data.success){// Add the new note to the user notes list\nsetNotesModal(prev=>({...prev,userNotes:[data.note,...prev.userNotes],newNote:''}));// Refresh the invoices to update the notes count\nloadUnpaidInvoices(currentPage,sortConfig,filters);}}}catch(error){console.error('Error adding note:',error);}};const deleteNote=async noteId=>{try{const response=await fetch(`${API_BASE}/orders/notes/${noteId}`,{method:'DELETE',headers:{'Authorization':`Bearer ${token}`}});if(response.ok){// Remove the note from the user notes list\nsetNotesModal(prev=>({...prev,userNotes:prev.userNotes.filter(note=>note.id!==noteId)}));// Refresh the invoices to update the notes count\nloadUnpaidInvoices(currentPage,sortConfig,filters);}}catch(error){console.error('Error deleting note:',error);}};// Payment link functionality\nconst generatePaymentLink=async orderId=>{try{console.log(`Generating payment link for order ${orderId}...`);const response=await fetch(`${API_BASE}/orders/${orderId}/payment-link`,{method:'POST',headers:{'Authorization':`Bearer ${token}`}});if(response.ok){const data=await response.json();if(data.success){console.log(`Payment link generated: ${data.paymentLink}`);// Refresh the invoices to show the new payment link\nloadUnpaidInvoices(currentPage,sortConfig,filters);// Optional: Show success message or open link immediately\nif(window.confirm('Payment link generated successfully! Would you like to open it now?')){window.open(data.paymentLink,'_blank');}}else{console.error('Payment link generation failed:',data.error);alert('Failed to generate payment link: '+data.error);}}else{console.error('Payment link generation request failed:',response.status);alert('Failed to generate payment link. Please try again.');}}catch(error){console.error('Error generating payment link:',error);alert('Error generating payment link. Please try again.');}};// Email functionality\nconst loadUserEmailSettings=async()=>{try{const response=await fetch(`${API_BASE}/user/email-settings`,{headers:{'Authorization':`Bearer ${token}`}});if(response.ok){const data=await response.json();if(data.success){setUserEmailSettings(data.settings);}}else if(response.status===404){// No email settings found\nsetUserEmailSettings(null);}}catch(error){console.error('Error loading email settings:',error);}};const openEmailModal=(invoice,emailType)=>{setEmailModal({isOpen:true,invoice:invoice,emailType:emailType});};const closeEmailModal=()=>{setEmailModal({isOpen:false,invoice:null,emailType:'invoice'});};const handleSendEmail=async emailData=>{try{const response=await fetch(`${API_BASE}/send-email`,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${token}`},body:JSON.stringify({orderId:emailData.orderId,emailType:emailData.emailType,to:emailData.to,subject:emailData.subject,body:emailData.body})});const result=await response.json();if(response.ok&&result.success){// No need to refresh entire dashboard - EmailModal will handle its own updates\nreturn true;}else{console.error('Email sending failed:',result.error);alert('Failed to send email: '+(result.error||'Unknown error'));return false;}}catch(error){console.error('Error sending email:',error);alert('Error sending email: '+error.message);return false;}};// Load email settings when component mounts\nuseEffect(()=>{loadUserEmailSettings();},[token]);// Get sort indicator for column headers\nconst getSortIndicator=column=>{if(sortConfig.column!==column)return' â†•ï¸';return sortConfig.order==='asc'?' â†‘':' â†“';};// Format currency\nconst formatCurrency=amount=>{return new Intl.NumberFormat('en-US',{style:'currency',currency:'USD'}).format(amount||0);};// Format date\nconst formatDate=dateString=>{if(!dateString)return'N/A';return new Date(dateString).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'});};// Render pagination controls\nconst renderPagination=()=>{if(!pagination||pagination.total_pages<=1)return null;const pages=[];const maxVisiblePages=5;let startPage=Math.max(1,pagination.current_page-Math.floor(maxVisiblePages/2));let endPage=Math.min(pagination.total_pages,startPage+maxVisiblePages-1);// Adjust start page if we're near the end\nif(endPage-startPage+1<maxVisiblePages){startPage=Math.max(1,endPage-maxVisiblePages+1);}return/*#__PURE__*/_jsxs(\"div\",{className:\"pagination-controls\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handlePageChange(1),disabled:pagination.current_page===1,className:\"btn-secondary pagination-btn\",children:\"\\u23EE\\uFE0F First\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handlePageChange(pagination.current_page-1),disabled:!pagination.has_prev_page,className:\"btn-secondary pagination-btn\",children:\"\\u25C0\\uFE0F Prev\"}),Array.from({length:endPage-startPage+1},(_,i)=>startPage+i).map(page=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>handlePageChange(page),className:`pagination-btn ${page===pagination.current_page?'active':'btn-secondary'}`,children:page},page)),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handlePageChange(pagination.current_page+1),disabled:!pagination.has_next_page,className:\"btn-secondary pagination-btn\",children:\"Next \\u25B6\\uFE0F\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handlePageChange(pagination.total_pages),disabled:pagination.current_page===pagination.total_pages,className:\"btn-secondary pagination-btn\",children:\"Last \\u23ED\\uFE0F\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"pagination-info\",children:[\"Page \",pagination.current_page,\" of \",pagination.total_pages,\"(\",pagination.total_count.toLocaleString(),\" total invoices)\"]})]});};return/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Invoice Dashboard\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"date-filter\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCC5 Date Range Filter\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"date-inputs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"Start Date:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:dateRange.start,onChange:e=>handleDateRangeChange('start',e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{children:\"End Date:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:dateRange.end,onChange:e=>handleDateRangeChange('end',e.target.value)})]})]})]}),statistics&&/*#__PURE__*/_jsxs(\"div\",{className:\"financial-overview\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCB0 Financial Overview\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"stats-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card total-orders\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Total Orders\"}),/*#__PURE__*/_jsx(\"p\",{className:\"stat-number\",children:statistics.total_orders.toLocaleString()}),/*#__PURE__*/_jsx(\"small\",{children:\"All orders in date range\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card paid-orders\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Paid Orders\"}),/*#__PURE__*/_jsx(\"p\",{className:\"stat-number\",children:statistics.paid_orders.toLocaleString()}),/*#__PURE__*/_jsx(\"p\",{className:\"stat-amount\",children:formatCurrency(statistics.paid_amount)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card unpaid-orders\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83D\\uDEA8 Unpaid Orders\"}),/*#__PURE__*/_jsx(\"p\",{className:\"stat-number unpaid\",children:statistics.unpaid_orders.toLocaleString()}),/*#__PURE__*/_jsx(\"p\",{className:\"stat-amount unpaid\",children:formatCurrency(statistics.unpaid_amount)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card total-revenue\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Total Revenue\"}),/*#__PURE__*/_jsx(\"p\",{className:\"stat-amount\",children:formatCurrency(statistics.total_amount)}),/*#__PURE__*/_jsx(\"small\",{children:\"Paid + Outstanding\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filters-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDD0D Filters\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"filters-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Days Outstanding:\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.daysOutstanding,onChange:e=>handleFilterChange('daysOutstanding',e.target.value),className:\"filter-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Invoices\"}),/*#__PURE__*/_jsx(\"option\",{value:\"over90\",children:\"Over 90 Days\"}),/*#__PURE__*/_jsx(\"option\",{value:\"60to90\",children:\"60-90 Days\"}),/*#__PURE__*/_jsx(\"option\",{value:\"30to60\",children:\"30-60 Days\"}),/*#__PURE__*/_jsx(\"option\",{value:\"under30\",children:\"Under 30 Days\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Search:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"search-group\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search invoices...\",value:filters.searchTerm,onChange:e=>handleFilterChange('searchTerm',e.target.value),className:\"search-input\"}),/*#__PURE__*/_jsxs(\"select\",{value:filters.searchType,onChange:e=>handleFilterChange('searchType',e.target.value),className:\"search-type-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"all\",children:\"All Fields\"}),/*#__PURE__*/_jsx(\"option\",{value:\"order_number\",children:\"Order Number\"}),/*#__PURE__*/_jsx(\"option\",{value:\"customer\",children:\"Customer Name/Email\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"filter-group\",children:/*#__PURE__*/_jsx(\"button\",{onClick:clearFilters,className:\"btn-secondary clear-filters-btn\",disabled:filters.daysOutstanding==='all'&&!filters.searchTerm.trim(),children:\"\\uD83D\\uDDD1\\uFE0F Clear Filters\"})})]}),(filters.daysOutstanding!=='all'||filters.searchTerm.trim())&&/*#__PURE__*/_jsxs(\"div\",{className:\"active-filters\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Active Filters:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-tags\",children:[filters.daysOutstanding!=='all'&&/*#__PURE__*/_jsxs(\"span\",{className:\"filter-tag\",children:[\"Days Outstanding: \",filters.daysOutstanding==='over90'?'Over 90 Days':filters.daysOutstanding==='60to90'?'60-90 Days':filters.daysOutstanding==='30to60'?'30-60 Days':'Under 30 Days',/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleFilterChange('daysOutstanding','all'),className:\"remove-filter\",children:\"\\xD7\"})]}),filters.searchTerm.trim()&&/*#__PURE__*/_jsxs(\"span\",{className:\"filter-tag\",children:[\"Search: \\\"\",filters.searchTerm,\"\\\" in \",filters.searchType==='all'?'All Fields':filters.searchType==='order_number'?'Order Number':'Customer Name/Email',/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleFilterChange('searchTerm',''),className:\"remove-filter\",children:\"\\xD7\"})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"unpaid-invoices-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCCB Unpaid Invoices\"}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Error:\"}),\" \",error]}),renderPagination(),isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\uD83D\\uDD04 Loading invoices...\"}):/*#__PURE__*/_jsx(_Fragment,{children:unpaidInvoices.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"no-invoices\",children:/*#__PURE__*/_jsx(\"p\",{children:\"\\u2705 No unpaid invoices found in the selected date range.\"})}):/*#__PURE__*/_jsxs(\"div\",{className:\"invoices-table\",children:[/*#__PURE__*/_jsxs(\"table\",{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('id'),className:\"sortable-header\",title:\"Click to sort by Order Number\",children:[\"Order #\",getSortIndicator('id')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('invoicenumber'),className:\"sortable-header\",title:\"Click to sort by Invoice Number\",children:[\"Invoice #\",getSortIndicator('invoicenumber')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('reference'),className:\"sortable-header\",title:\"Click to sort by Order Reference\",children:[\"Order Ref\",getSortIndicator('reference')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('customercontact_id'),className:\"sortable-header\",title:\"Click to sort by Billing Contact\",children:[\"Billing Contact\",getSortIndicator('customercontact_id')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('deliverycontact_id'),className:\"sortable-header\",title:\"Click to sort by Delivery Contact\",children:[\"Delivery Contact\",getSortIndicator('deliverycontact_id')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('company_name'),className:\"sortable-header\",title:\"Click to sort by Company\",children:[\"Company\",getSortIndicator('company_name')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('placedon'),className:\"sortable-header\",title:\"Click to sort by Order Date\",children:[\"Order Date\",getSortIndicator('placedon')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('totalvalue'),className:\"sortable-header\",title:\"Click to sort by Amount\",children:[\"Amount\",getSortIndicator('totalvalue')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('payment_status'),className:\"sortable-header\",title:\"Click to sort by Invoice Status\",children:[\"Invoice Status\",getSortIndicator('payment_status')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('order_status'),className:\"sortable-header\",title:\"Click to sort by Order Status\",children:[\"Order Status\",getSortIndicator('order_status')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('shipping_status'),className:\"sortable-header\",title:\"Click to sort by Shipping Status\",children:[\"Shipping Status\",getSortIndicator('shipping_status')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('stock_status'),className:\"sortable-header\",title:\"Click to sort by Stock Status\",children:[\"Stock Status\",getSortIndicator('stock_status')]}),/*#__PURE__*/_jsxs(\"th\",{onClick:()=>handleSort('days_outstanding'),className:\"sortable-header\",title:\"Click to sort by Days Outstanding\",children:[\"Days Outstanding\",getSortIndicator('days_outstanding')]}),/*#__PURE__*/_jsx(\"th\",{children:\"Notes\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Payment\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Email Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:unpaidInvoices.map(invoice=>{var _invoice$billingConta,_invoice$billingConta2,_invoice$deliveryCont,_invoice$deliveryCont2,_invoice$paymentStatu,_invoice$brightpearlN,_invoice$brightpearlN2;const orderDate=new Date(invoice.orderDate);const daysOutstanding=invoice.days_outstanding||Math.floor((new Date()-orderDate)/(1000*60*60*24));return/*#__PURE__*/_jsxs(\"tr\",{className:daysOutstanding>30?'overdue':'',children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:invoice.orderNumber||`#${invoice.id}`})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:invoice.invoiceNumber||'N/A'})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"strong\",{children:invoice.orderRef||'N/A'})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:((_invoice$billingConta=invoice.billingContact)===null||_invoice$billingConta===void 0?void 0:_invoice$billingConta.name)||invoice.customer.name}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{children:((_invoice$billingConta2=invoice.billingContact)===null||_invoice$billingConta2===void 0?void 0:_invoice$billingConta2.email)||invoice.customer.email})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:((_invoice$deliveryCont=invoice.deliveryContact)===null||_invoice$deliveryCont===void 0?void 0:_invoice$deliveryCont.name)||'Same as Billing'}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{children:((_invoice$deliveryCont2=invoice.deliveryContact)===null||_invoice$deliveryCont2===void 0?void 0:_invoice$deliveryCont2.email)||''})]})}),/*#__PURE__*/_jsx(\"td\",{children:invoice.company.name||'N/A'}),/*#__PURE__*/_jsx(\"td\",{children:formatDate(invoice.orderDate)}),/*#__PURE__*/_jsx(\"td\",{children:(_invoice$paymentStatu=invoice.paymentStatus)!==null&&_invoice$paymentStatu!==void 0&&_invoice$paymentStatu.toLowerCase().includes('partial')&&invoice.paidAmount>0?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:formatCurrency(invoice.outstandingAmount)}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"small\",{style:{color:'#6c757d'},children:[\"Total: \",formatCurrency(invoice.totalAmount),\" | Paid: \",formatCurrency(invoice.paidAmount)]})]}):/*#__PURE__*/_jsx(\"strong\",{children:formatCurrency(invoice.totalAmount)})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"status-badge\",style:{backgroundColor:invoice.paymentStatusColor||invoice.statusColor,color:'white'},children:invoice.paymentStatus})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"status-badge\",style:{backgroundColor:invoice.orderStatusColor,color:'white'},children:invoice.orderStatus})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"status-badge\",style:{backgroundColor:invoice.shippingStatusColor,color:'white'},children:invoice.shippingStatus})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"status-badge\",style:{backgroundColor:invoice.stockStatusColor,color:'white'},children:invoice.stockStatus})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"span\",{className:daysOutstanding>30?'overdue-days':'normal-days',children:[daysOutstanding,\" days\"]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"button\",{className:\"notes-button\",onClick:()=>openNotesModal(invoice),title:invoice.hasNotes||invoice.hasBrightpearlNotes?`View ${invoice.notesCount||0} user note${(invoice.notesCount||0)!==1?'s':''} + ${invoice.brightpearlNotesCount||0} Brightpearl note${(invoice.brightpearlNotesCount||0)!==1?'s':''}${(_invoice$brightpearlN=invoice.brightpearlNotes)!==null&&_invoice$brightpearlN!==void 0&&_invoice$brightpearlN.some(note=>note.fileId)?' (includes file attachments)':''}`:'Add note',children:[\"\\uD83D\\uDCDD\",(invoice.notesCount>0||invoice.brightpearlNotesCount>0)&&/*#__PURE__*/_jsx(\"span\",{className:\"notes-count\",children:(invoice.notesCount||0)+(invoice.brightpearlNotesCount||0)}),invoice.hasBrightpearlNotes&&/*#__PURE__*/_jsx(\"span\",{className:\"brightpearl-indicator\",title:\"Has Brightpearl notes\",children:\"\\u2728\"}),((_invoice$brightpearlN2=invoice.brightpearlNotes)===null||_invoice$brightpearlN2===void 0?void 0:_invoice$brightpearlN2.some(note=>note.fileId))&&/*#__PURE__*/_jsx(\"span\",{className:\"attachment-indicator\",title:\"Has file attachments\",children:\"\\uD83D\\uDCCE\"})]})}),/*#__PURE__*/_jsx(\"td\",{children:invoice.hasPaymentLink?/*#__PURE__*/_jsx(\"a\",{href:invoice.paymentLink,target:\"_blank\",rel:\"noopener noreferrer\",className:\"payment-link-button\",title:\"Open payment link in new tab\",children:\"\\uD83D\\uDCB3 Pay Now\"}):/*#__PURE__*/_jsx(\"button\",{className:\"generate-payment-link-button\",onClick:()=>generatePaymentLink(invoice.id),title:\"Generate payment link\",children:\"\\uD83D\\uDD17 Generate Link\"})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"email-actions\",children:userEmailSettings!==null&&userEmailSettings!==void 0&&userEmailSettings.google_app_password?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"email-button invoice-btn\",onClick:()=>openEmailModal(invoice,'invoice'),title:\"Send invoice email\",children:\"\\uD83D\\uDCE7 Invoice\"}),/*#__PURE__*/_jsx(\"button\",{className:\"email-button reminder-btn\",onClick:()=>openEmailModal(invoice,'reminder'),title:\"Send reminder email\",children:\"\\u26A0\\uFE0F Reminder\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"email-not-configured\",children:/*#__PURE__*/_jsx(\"small\",{children:\"Email not configured\"})})})})]},invoice.id);})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"table-summary\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"Showing \",unpaidInvoices.length,\" of \",(pagination===null||pagination===void 0?void 0:(_pagination$total_cou=pagination.total_count)===null||_pagination$total_cou===void 0?void 0:_pagination$total_cou.toLocaleString())||0,\" unpaid invoices. Total outstanding: \",/*#__PURE__*/_jsx(\"strong\",{children:formatCurrency(unpaidInvoices.reduce((sum,inv)=>sum+(inv.outstandingAmount||inv.totalAmount),0))})]})})]})}),renderPagination()]}),/*#__PURE__*/_jsxs(\"div\",{className:\"quick-actions\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u26A1 Quick Actions\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"action-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>loadUnpaidInvoices(currentPage,sortConfig),disabled:isLoading,className:\"btn-primary\",children:isLoading?'ðŸ”„ Refreshing...':'ðŸ”„ Refresh Invoices'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setDateRange({start:new Date(Date.now()-30*24*60*60*1000).toISOString().split('T')[0],end:new Date().toISOString().split('T')[0]});},className:\"btn-secondary\",children:\"\\uD83D\\uDCC5 Last 30 Days\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setDateRange({start:new Date(Date.now()-90*24*60*60*1000).toISOString().split('T')[0],end:new Date().toISOString().split('T')[0]});},className:\"btn-secondary\",children:\"\\uD83D\\uDCC5 Last 90 Days\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"connection-status\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDD17 System Status\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"status-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"status-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"status-icon\",children:\"\\u2705\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Database Connection\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{children:\"Connected to Supabase\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"status-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"status-icon\",children:\"\\u2705\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Brightpearl Data\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{children:\"Real-time invoice data\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"status-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"status-icon\",children:\"\\u2705\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"API Service\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{children:\"All systems operational\"})]})]})]})]}),notesModal.isOpen&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:closeNotesModal,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"\\uD83D\\uDCDD Notes for Order #\",(_notesModal$invoice=notesModal.invoice)===null||_notesModal$invoice===void 0?void 0:_notesModal$invoice.id]}),/*#__PURE__*/_jsx(\"button\",{className:\"modal-close\",onClick:closeNotesModal,children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"add-note-section\",children:[/*#__PURE__*/_jsx(\"textarea\",{value:notesModal.newNote,onChange:e=>setNotesModal(prev=>({...prev,newNote:e.target.value})),placeholder:\"Add a note for this order...\",className:\"note-textarea\",rows:\"3\"}),/*#__PURE__*/_jsx(\"button\",{onClick:addNote,className:\"btn-primary add-note-btn\",disabled:!notesModal.newNote.trim(),children:\"Add Note\"})]}),notesModal.isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"Loading notes...\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[notesModal.brightpearlNotes&&notesModal.brightpearlNotes.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"notes-section\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"notes-section-title\",children:[\"\\u2728 Brightpearl Notes (\",notesModal.brightpearlNotes.length,\")\",/*#__PURE__*/_jsx(\"small\",{children:\"From Brightpearl system\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"notes-list brightpearl-notes\",children:notesModal.brightpearlNotes.map(note=>/*#__PURE__*/_jsxs(\"div\",{className:\"note-item brightpearl-note\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"note-content\",children:[note.text,note.fileId&&/*#__PURE__*/_jsx(\"div\",{className:\"note-attachment\",children:/*#__PURE__*/_jsxs(\"a\",{href:`https://use1.brightpearlapp.com/filestore.php?id=${note.fileId}`,target:\"_blank\",rel:\"noopener noreferrer\",className:\"attachment-link\",title:\"View attached file\",children:[\"\\uD83D\\uDCCE File Attachment (ID: \",note.fileId,\")\"]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"note-meta\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"note-author\",children:[\"Contact ID: \",note.contactId,\" | Added by: \",note.addedBy]}),/*#__PURE__*/_jsx(\"span\",{className:\"note-date\",children:note.formattedDate}),/*#__PURE__*/_jsx(\"span\",{className:\"note-visibility\",children:note.isPublic?'ðŸŒ Public':'ðŸ”’ Private'}),note.orderStatusId&&/*#__PURE__*/_jsxs(\"span\",{className:\"note-status\",children:[\"Status: \",note.orderStatusId]})]})]},`bp-${note.id}`))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"notes-section\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"notes-section-title\",children:[\"\\uD83D\\uDC64 Your Notes (\",notesModal.userNotes.length,\")\",/*#__PURE__*/_jsx(\"small\",{children:\"Added by portal users\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"notes-list user-notes\",children:notesModal.userNotes.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"no-notes\",children:\"No user notes yet for this order.\"}):notesModal.userNotes.map(note=>{var _note$app_users,_note$app_users2,_note$app_users3;return/*#__PURE__*/_jsxs(\"div\",{className:\"note-item user-note\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"note-content\",children:note.note}),/*#__PURE__*/_jsxs(\"div\",{className:\"note-meta\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"note-author\",children:[\"by \",(_note$app_users=note.app_users)!==null&&_note$app_users!==void 0&&_note$app_users.first_name&&(_note$app_users2=note.app_users)!==null&&_note$app_users2!==void 0&&_note$app_users2.last_name?`${note.app_users.first_name} ${note.app_users.last_name}`:((_note$app_users3=note.app_users)===null||_note$app_users3===void 0?void 0:_note$app_users3.email)||'Unknown']}),/*#__PURE__*/_jsx(\"span\",{className:\"note-date\",children:new Date(note.created_at).toLocaleString()}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>deleteNote(note.id),className:\"delete-note-btn\",title:\"Delete note\",children:\"\\uD83D\\uDDD1\\uFE0F\"})]})]},`user-${note.id}`);})})]}),(!notesModal.userNotes||notesModal.userNotes.length===0)&&(!notesModal.brightpearlNotes||notesModal.brightpearlNotes.length===0)&&/*#__PURE__*/_jsxs(\"div\",{className:\"no-notes\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"No notes found for this order.\"}),/*#__PURE__*/_jsx(\"small\",{children:\"Add your first note using the form above.\"})]})]})]})]})}),emailModal.isOpen&&/*#__PURE__*/_jsx(EmailModal,{isOpen:emailModal.isOpen,invoice:emailModal.invoice,emailType:emailModal.emailType,onClose:closeEmailModal,onSend:handleSendEmail,token:token})]});}export default InvoiceDashboard;","map":{"version":3,"names":["React","useState","useEffect","EmailModal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","API_BASE","InvoiceDashboard","_ref","_pagination$total_cou","_notesModal$invoice","token","statistics","setStatistics","unpaidInvoices","setUnpaidInvoices","pagination","setPagination","isLoading","setIsLoading","error","setError","dateRange","setDateRange","start","end","Date","toISOString","split","currentPage","setCurrentPage","sortConfig","setSortConfig","column","order","itemsPerPage","setItemsPerPage","settings","setSettings","filters","setFilters","daysOutstanding","searchTerm","searchType","notesModal","setNotesModal","isOpen","invoice","userNotes","brightpearlNotes","newNote","emailModal","setEmailModal","emailType","userEmailSettings","setUserEmailSettings","loadStatistics","response","fetch","headers","ok","data","json","success","console","loadUnpaidInvoices","page","arguments","length","undefined","sort","currentFilters","params","URLSearchParams","start_date","end_date","limit","sort_by","sort_order","append","trim","invoices","loadSettings","perPage","parseInt","invoices_per_page","initializeData","handleDateRangeChange","field","value","prev","handlePageChange","newPage","handleSort","newOrder","newSortConfig","handleFilterChange","filterType","clearFilters","openNotesModal","id","notes","closeNotesModal","addNote","method","body","JSON","stringify","note","deleteNote","noteId","filter","generatePaymentLink","orderId","log","paymentLink","window","confirm","open","alert","status","loadUserEmailSettings","openEmailModal","closeEmailModal","handleSendEmail","emailData","to","subject","result","message","getSortIndicator","formatCurrency","amount","Intl","NumberFormat","style","currency","format","formatDate","dateString","toLocaleDateString","year","month","day","renderPagination","total_pages","pages","maxVisiblePages","startPage","Math","max","current_page","floor","endPage","min","className","children","onClick","disabled","has_prev_page","Array","from","_","i","map","has_next_page","total_count","toLocaleString","type","onChange","e","target","total_orders","paid_orders","paid_amount","unpaid_orders","unpaid_amount","total_amount","placeholder","title","_invoice$billingConta","_invoice$billingConta2","_invoice$deliveryCont","_invoice$deliveryCont2","_invoice$paymentStatu","_invoice$brightpearlN","_invoice$brightpearlN2","orderDate","days_outstanding","orderNumber","invoiceNumber","orderRef","billingContact","name","customer","email","deliveryContact","company","paymentStatus","toLowerCase","includes","paidAmount","outstandingAmount","color","totalAmount","backgroundColor","paymentStatusColor","statusColor","orderStatusColor","orderStatus","shippingStatusColor","shippingStatus","stockStatusColor","stockStatus","hasNotes","hasBrightpearlNotes","notesCount","brightpearlNotesCount","some","fileId","hasPaymentLink","href","rel","google_app_password","reduce","sum","inv","now","stopPropagation","rows","text","contactId","addedBy","formattedDate","isPublic","orderStatusId","_note$app_users","_note$app_users2","_note$app_users3","app_users","first_name","last_name","created_at","onClose","onSend"],"sources":["/home/collegesportsdir/public_html/texon-invoicing-portal/client/src/InvoiceDashboard.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport EmailModal from './EmailModal';\n\nconst API_BASE = '/texon-invoicing-portal/api';\n\nfunction InvoiceDashboard({ token }) {\n  const [statistics, setStatistics] = useState(null);\n  const [unpaidInvoices, setUnpaidInvoices] = useState([]);\n  const [pagination, setPagination] = useState(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [dateRange, setDateRange] = useState({\n    start: '2024-01-01',\n    end: new Date().toISOString().split('T')[0]\n  });\n  const [currentPage, setCurrentPage] = useState(1);\n  const [sortConfig, setSortConfig] = useState({\n    column: 'placedon',\n    order: 'desc'\n  });\n  const [itemsPerPage, setItemsPerPage] = useState(25);\n  const [settings, setSettings] = useState({});\n  const [filters, setFilters] = useState({\n    daysOutstanding: 'all', // all, over90, 60to90, 30to60, under30\n    searchTerm: '',\n    searchType: 'all' // all, order_number, customer\n  });\n  const [notesModal, setNotesModal] = useState({\n    isOpen: false,\n    invoice: null,\n    userNotes: [],\n    brightpearlNotes: [],\n    isLoading: false,\n    newNote: ''\n  });\n\n  // Email functionality state\n  const [emailModal, setEmailModal] = useState({\n    isOpen: false,\n    invoice: null,\n    emailType: 'invoice' // 'invoice' or 'reminder'\n  });\n  const [userEmailSettings, setUserEmailSettings] = useState(null);\n\n  // Load invoice statistics\n  const loadStatistics = async () => {\n    try {\n      const response = await fetch(\n        `${API_BASE}/invoices/statistics?start_date=${dateRange.start}&end_date=${dateRange.end}`,\n        { headers: { 'Authorization': `Bearer ${token}` } }\n      );\n      \n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          setStatistics(data.statistics);\n        }\n      }\n    } catch (error) {\n      console.error('Error loading statistics:', error);\n    }\n  };\n\n  // Load unpaid invoices with pagination and sorting\n  const loadUnpaidInvoices = async (page = currentPage, sort = sortConfig, currentFilters = filters) => {\n    setIsLoading(true);\n    setError('');\n    \n    try {\n      const params = new URLSearchParams({\n        start_date: dateRange.start,\n        end_date: dateRange.end,\n        page: page,\n        limit: itemsPerPage,\n        sort_by: sort.column,\n        sort_order: sort.order\n      });\n\n      // Add filter parameters\n      if (currentFilters.daysOutstanding !== 'all') {\n        params.append('days_outstanding_filter', currentFilters.daysOutstanding);\n      }\n      \n      if (currentFilters.searchTerm.trim()) {\n        params.append('search_term', currentFilters.searchTerm.trim());\n        params.append('search_type', currentFilters.searchType);\n      }\n\n      const response = await fetch(\n        `${API_BASE}/invoices/unpaid?${params}`,\n        { headers: { 'Authorization': `Bearer ${token}` } }\n      );\n      \n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          setUnpaidInvoices(data.invoices);\n          setPagination(data.pagination);\n        } else {\n          setError(data.error || 'Failed to load invoices');\n        }\n      } else {\n        setError('Server error loading invoices');\n      }\n    } catch (error) {\n      setError('Network error loading invoices');\n    }\n    \n    setIsLoading(false);\n  };\n\n  // Load settings to get per-page configuration\n  const loadSettings = async () => {\n    try {\n      const response = await fetch(`${API_BASE}/settings`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        setSettings(data);\n        \n        // Update items per page from settings\n        const perPage = parseInt(data.invoices_per_page) || 25;\n        setItemsPerPage(perPage);\n        return perPage; // Return the per page value so we can use it immediately\n      }\n    } catch (error) {\n      console.error('Error loading settings:', error);\n      // Keep default value if settings load fails\n    }\n    return 25; // Return default if loading fails\n  };\n\n  // Load data when component mounts or parameters change\n  useEffect(() => {\n    const initializeData = async () => {\n      const perPage = await loadSettings(); // Wait for settings to load first\n      loadStatistics();\n      // Load invoices with the correct per-page setting\n      loadUnpaidInvoices(currentPage, sortConfig, filters);\n    };\n    \n    initializeData();\n  }, [dateRange]);\n\n  // Reload invoices when items per page changes\n  useEffect(() => {\n    if (itemsPerPage !== 25) { // Only reload if different from default\n      setCurrentPage(1); // Reset to first page\n      loadUnpaidInvoices(1, sortConfig);\n    }\n  }, [itemsPerPage]);\n\n  // Reload invoices when filters change\n  useEffect(() => {\n    setCurrentPage(1); // Reset to first page when filters change\n    loadUnpaidInvoices(1, sortConfig, filters);\n  }, [filters]);\n\n  // Handle date range changes\n  const handleDateRangeChange = (field, value) => {\n    setDateRange(prev => ({ ...prev, [field]: value }));\n    setCurrentPage(1); // Reset to first page when date range changes\n  };\n\n  // Handle page changes\n  const handlePageChange = (newPage) => {\n    setCurrentPage(newPage);\n    loadUnpaidInvoices(newPage, sortConfig, filters);\n  };\n\n  // Handle sorting\n  const handleSort = (column) => {\n    const newOrder = sortConfig.column === column && sortConfig.order === 'desc' ? 'asc' : 'desc';\n    const newSortConfig = { column, order: newOrder };\n    setSortConfig(newSortConfig);\n    setCurrentPage(1); // Reset to first page when sorting changes\n    loadUnpaidInvoices(1, newSortConfig, filters);\n  };\n\n  // Handle filter changes\n  const handleFilterChange = (filterType, value) => {\n    setFilters(prev => ({\n      ...prev,\n      [filterType]: value\n    }));\n  };\n\n  // Clear all filters\n  const clearFilters = () => {\n    setFilters({\n      daysOutstanding: 'all',\n      searchTerm: '',\n      searchType: 'all'\n    });\n  };\n\n  // Notes functionality\n  const openNotesModal = async (invoice) => {\n    setNotesModal(prev => ({\n      ...prev,\n      isOpen: true,\n      invoice: invoice,\n      isLoading: true,\n      userNotes: [],\n      brightpearlNotes: [],\n      newNote: ''\n    }));\n\n    // Load notes for this order\n    try {\n      const response = await fetch(`${API_BASE}/orders/${invoice.id}/notes`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          setNotesModal(prev => ({\n            ...prev,\n            userNotes: data.userNotes || data.notes || [], // Handle both old and new API format\n            brightpearlNotes: data.brightpearlNotes || [],\n            isLoading: false\n          }));\n        }\n      }\n    } catch (error) {\n      console.error('Error loading notes:', error);\n      setNotesModal(prev => ({ ...prev, isLoading: false }));\n    }\n  };\n\n  const closeNotesModal = () => {\n    setNotesModal({\n      isOpen: false,\n      invoice: null,\n      userNotes: [],\n      brightpearlNotes: [],\n      isLoading: false,\n      newNote: ''\n    });\n  };\n\n  const addNote = async () => {\n    if (!notesModal.newNote.trim()) return;\n\n    try {\n      const response = await fetch(`${API_BASE}/orders/${notesModal.invoice.id}/notes`, {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ note: notesModal.newNote.trim() })\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          // Add the new note to the user notes list\n          setNotesModal(prev => ({\n            ...prev,\n            userNotes: [data.note, ...prev.userNotes],\n            newNote: ''\n          }));\n          \n          // Refresh the invoices to update the notes count\n          loadUnpaidInvoices(currentPage, sortConfig, filters);\n        }\n      }\n    } catch (error) {\n      console.error('Error adding note:', error);\n    }\n  };\n\n  const deleteNote = async (noteId) => {\n    try {\n      const response = await fetch(`${API_BASE}/orders/notes/${noteId}`, {\n        method: 'DELETE',\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n\n      if (response.ok) {\n        // Remove the note from the user notes list\n        setNotesModal(prev => ({\n          ...prev,\n          userNotes: prev.userNotes.filter(note => note.id !== noteId)\n        }));\n        \n        // Refresh the invoices to update the notes count\n        loadUnpaidInvoices(currentPage, sortConfig, filters);\n      }\n    } catch (error) {\n      console.error('Error deleting note:', error);\n    }\n  };\n\n  // Payment link functionality\n  const generatePaymentLink = async (orderId) => {\n    try {\n      console.log(`Generating payment link for order ${orderId}...`);\n\n      const response = await fetch(`${API_BASE}/orders/${orderId}/payment-link`, {\n        method: 'POST',\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          console.log(`Payment link generated: ${data.paymentLink}`);\n          \n          // Refresh the invoices to show the new payment link\n          loadUnpaidInvoices(currentPage, sortConfig, filters);\n          \n          // Optional: Show success message or open link immediately\n          if (window.confirm('Payment link generated successfully! Would you like to open it now?')) {\n            window.open(data.paymentLink, '_blank');\n          }\n        } else {\n          console.error('Payment link generation failed:', data.error);\n          alert('Failed to generate payment link: ' + data.error);\n        }\n      } else {\n        console.error('Payment link generation request failed:', response.status);\n        alert('Failed to generate payment link. Please try again.');\n      }\n    } catch (error) {\n      console.error('Error generating payment link:', error);\n      alert('Error generating payment link. Please try again.');\n    }\n  };\n\n  // Email functionality\n  const loadUserEmailSettings = async () => {\n    try {\n      const response = await fetch(`${API_BASE}/user/email-settings`, {\n        headers: { 'Authorization': `Bearer ${token}` }\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        if (data.success) {\n          setUserEmailSettings(data.settings);\n        }\n      } else if (response.status === 404) {\n        // No email settings found\n        setUserEmailSettings(null);\n      }\n    } catch (error) {\n      console.error('Error loading email settings:', error);\n    }\n  };\n\n  const openEmailModal = (invoice, emailType) => {\n    setEmailModal({\n      isOpen: true,\n      invoice: invoice,\n      emailType: emailType\n    });\n  };\n\n  const closeEmailModal = () => {\n    setEmailModal({\n      isOpen: false,\n      invoice: null,\n      emailType: 'invoice'\n    });\n  };\n\n  const handleSendEmail = async (emailData) => {\n    try {\n      const response = await fetch(`${API_BASE}/send-email`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          orderId: emailData.orderId,\n          emailType: emailData.emailType,\n          to: emailData.to,\n          subject: emailData.subject,\n          body: emailData.body\n        })\n      });\n\n      const result = await response.json();\n      \n      if (response.ok && result.success) {\n        // No need to refresh entire dashboard - EmailModal will handle its own updates\n        return true;\n      } else {\n        console.error('Email sending failed:', result.error);\n        alert('Failed to send email: ' + (result.error || 'Unknown error'));\n        return false;\n      }\n    } catch (error) {\n      console.error('Error sending email:', error);\n      alert('Error sending email: ' + error.message);\n      return false;\n    }\n  };\n\n  // Load email settings when component mounts\n  useEffect(() => {\n    loadUserEmailSettings();\n  }, [token]);\n\n  // Get sort indicator for column headers\n  const getSortIndicator = (column) => {\n    if (sortConfig.column !== column) return ' â†•ï¸';\n    return sortConfig.order === 'asc' ? ' â†‘' : ' â†“';\n  };\n\n  // Format currency\n  const formatCurrency = (amount) => {\n    return new Intl.NumberFormat('en-US', {\n      style: 'currency',\n      currency: 'USD'\n    }).format(amount || 0);\n  };\n\n  // Format date\n  const formatDate = (dateString) => {\n    if (!dateString) return 'N/A';\n    return new Date(dateString).toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  };\n\n  // Render pagination controls\n  const renderPagination = () => {\n    if (!pagination || pagination.total_pages <= 1) return null;\n\n    const pages = [];\n    const maxVisiblePages = 5;\n    let startPage = Math.max(1, pagination.current_page - Math.floor(maxVisiblePages / 2));\n    let endPage = Math.min(pagination.total_pages, startPage + maxVisiblePages - 1);\n\n    // Adjust start page if we're near the end\n    if (endPage - startPage + 1 < maxVisiblePages) {\n      startPage = Math.max(1, endPage - maxVisiblePages + 1);\n    }\n\n    return (\n      <div className=\"pagination-controls\">\n        <button \n          onClick={() => handlePageChange(1)}\n          disabled={pagination.current_page === 1}\n          className=\"btn-secondary pagination-btn\"\n        >\n          â®ï¸ First\n        </button>\n        \n        <button \n          onClick={() => handlePageChange(pagination.current_page - 1)}\n          disabled={!pagination.has_prev_page}\n          className=\"btn-secondary pagination-btn\"\n        >\n          â—€ï¸ Prev\n        </button>\n\n        {Array.from({ length: endPage - startPage + 1 }, (_, i) => startPage + i).map(page => (\n          <button\n            key={page}\n            onClick={() => handlePageChange(page)}\n            className={`pagination-btn ${page === pagination.current_page ? 'active' : 'btn-secondary'}`}\n          >\n            {page}\n          </button>\n        ))}\n\n        <button \n          onClick={() => handlePageChange(pagination.current_page + 1)}\n          disabled={!pagination.has_next_page}\n          className=\"btn-secondary pagination-btn\"\n        >\n          Next â–¶ï¸\n        </button>\n        \n        <button \n          onClick={() => handlePageChange(pagination.total_pages)}\n          disabled={pagination.current_page === pagination.total_pages}\n          className=\"btn-secondary pagination-btn\"\n        >\n          Last â­ï¸\n        </button>\n\n        <span className=\"pagination-info\">\n          Page {pagination.current_page} of {pagination.total_pages} \n          ({pagination.total_count.toLocaleString()} total invoices)\n        </span>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"dashboard\">\n      <h2>Invoice Dashboard</h2>\n      \n      {/* Date Range Filter */}\n      <div className=\"date-filter\">\n        <h3>ðŸ“… Date Range Filter</h3>\n        <div className=\"date-inputs\">\n          <div>\n            <label>Start Date:</label>\n            <input\n              type=\"date\"\n              value={dateRange.start}\n              onChange={(e) => handleDateRangeChange('start', e.target.value)}\n            />\n          </div>\n          <div>\n            <label>End Date:</label>\n            <input\n              type=\"date\"\n              value={dateRange.end}\n              onChange={(e) => handleDateRangeChange('end', e.target.value)}\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* Financial Overview */}\n      {statistics && (\n        <div className=\"financial-overview\">\n          <h3>ðŸ’° Financial Overview</h3>\n          <div className=\"stats-grid\">\n            <div className=\"stat-card total-orders\">\n              <h4>Total Orders</h4>\n              <p className=\"stat-number\">{statistics.total_orders.toLocaleString()}</p>\n              <small>All orders in date range</small>\n            </div>\n            \n            <div className=\"stat-card paid-orders\">\n              <h4>Paid Orders</h4>\n              <p className=\"stat-number\">{statistics.paid_orders.toLocaleString()}</p>\n              <p className=\"stat-amount\">{formatCurrency(statistics.paid_amount)}</p>\n            </div>\n            \n            <div className=\"stat-card unpaid-orders\">\n              <h4>ðŸš¨ Unpaid Orders</h4>\n              <p className=\"stat-number unpaid\">{statistics.unpaid_orders.toLocaleString()}</p>\n              <p className=\"stat-amount unpaid\">{formatCurrency(statistics.unpaid_amount)}</p>\n            </div>\n            \n            <div className=\"stat-card total-revenue\">\n              <h4>Total Revenue</h4>\n              <p className=\"stat-amount\">{formatCurrency(statistics.total_amount)}</p>\n              <small>Paid + Outstanding</small>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Filters */}\n      <div className=\"filters-section\">\n        <h3>ðŸ” Filters</h3>\n        <div className=\"filters-grid\">\n          <div className=\"filter-group\">\n            <label>Days Outstanding:</label>\n            <select \n              value={filters.daysOutstanding} \n              onChange={(e) => handleFilterChange('daysOutstanding', e.target.value)}\n              className=\"filter-select\"\n            >\n              <option value=\"all\">All Invoices</option>\n              <option value=\"over90\">Over 90 Days</option>\n              <option value=\"60to90\">60-90 Days</option>\n              <option value=\"30to60\">30-60 Days</option>\n              <option value=\"under30\">Under 30 Days</option>\n            </select>\n          </div>\n          \n          <div className=\"filter-group\">\n            <label>Search:</label>\n            <div className=\"search-group\">\n              <input\n                type=\"text\"\n                placeholder=\"Search invoices...\"\n                value={filters.searchTerm}\n                onChange={(e) => handleFilterChange('searchTerm', e.target.value)}\n                className=\"search-input\"\n              />\n              <select \n                value={filters.searchType} \n                onChange={(e) => handleFilterChange('searchType', e.target.value)}\n                className=\"search-type-select\"\n              >\n                <option value=\"all\">All Fields</option>\n                <option value=\"order_number\">Order Number</option>\n                <option value=\"customer\">Customer Name/Email</option>\n              </select>\n            </div>\n          </div>\n          \n          <div className=\"filter-group\">\n            <button \n              onClick={clearFilters}\n              className=\"btn-secondary clear-filters-btn\"\n              disabled={filters.daysOutstanding === 'all' && !filters.searchTerm.trim()}\n            >\n              ðŸ—‘ï¸ Clear Filters\n            </button>\n          </div>\n        </div>\n        \n        {/* Active Filters Display */}\n        {(filters.daysOutstanding !== 'all' || filters.searchTerm.trim()) && (\n          <div className=\"active-filters\">\n            <h4>Active Filters:</h4>\n            <div className=\"filter-tags\">\n              {filters.daysOutstanding !== 'all' && (\n                <span className=\"filter-tag\">\n                  Days Outstanding: {\n                    filters.daysOutstanding === 'over90' ? 'Over 90 Days' :\n                    filters.daysOutstanding === '60to90' ? '60-90 Days' :\n                    filters.daysOutstanding === '30to60' ? '30-60 Days' :\n                    'Under 30 Days'\n                  }\n                  <button \n                    onClick={() => handleFilterChange('daysOutstanding', 'all')}\n                    className=\"remove-filter\"\n                  >\n                    Ã—\n                  </button>\n                </span>\n              )}\n              \n              {filters.searchTerm.trim() && (\n                <span className=\"filter-tag\">\n                  Search: \"{filters.searchTerm}\" in {\n                    filters.searchType === 'all' ? 'All Fields' :\n                    filters.searchType === 'order_number' ? 'Order Number' :\n                    'Customer Name/Email'\n                  }\n                  <button \n                    onClick={() => handleFilterChange('searchTerm', '')}\n                    className=\"remove-filter\"\n                  >\n                    Ã—\n                  </button>\n                </span>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Unpaid Invoices Table */}\n      <div className=\"unpaid-invoices-section\">\n        <h3>ðŸ“‹ Unpaid Invoices</h3>\n        \n        {error && (\n          <div className=\"error-message\">\n            <strong>Error:</strong> {error}\n          </div>\n        )}\n        \n        {renderPagination()}\n        \n        {isLoading ? (\n          <div className=\"loading\">ðŸ”„ Loading invoices...</div>\n        ) : (\n          <>\n            {unpaidInvoices.length === 0 ? (\n              <div className=\"no-invoices\">\n                <p>âœ… No unpaid invoices found in the selected date range.</p>\n              </div>\n            ) : (\n              <div className=\"invoices-table\">\n                <table>\n                  <thead>\n                    <tr>\n                      <th \n                        onClick={() => handleSort('id')} \n                        className=\"sortable-header\"\n                        title=\"Click to sort by Order Number\"\n                      >\n                        Order #{getSortIndicator('id')}\n                      </th>\n                      <th \n                        onClick={() => handleSort('invoicenumber')} \n                        className=\"sortable-header\"\n                        title=\"Click to sort by Invoice Number\"\n                      >\n                        Invoice #{getSortIndicator('invoicenumber')}\n                      </th>\n                      <th \n                        onClick={() => handleSort('reference')} \n                        className=\"sortable-header\"\n                        title=\"Click to sort by Order Reference\"\n                      >\n                        Order Ref{getSortIndicator('reference')}\n                      </th>\n                      <th \n                        onClick={() => handleSort('customercontact_id')} \n                        className=\"sortable-header\"\n                        title=\"Click to sort by Billing Contact\"\n                      >\n                        Billing Contact{getSortIndicator('customercontact_id')}\n                      </th>\n                      <th \n                        onClick={() => handleSort('deliverycontact_id')} \n                        className=\"sortable-header\"\n                        title=\"Click to sort by Delivery Contact\"\n                      >\n                        Delivery Contact{getSortIndicator('deliverycontact_id')}\n                      </th>\n                      <th \n                        onClick={() => handleSort('company_name')} \n                        className=\"sortable-header\"\n                        title=\"Click to sort by Company\"\n                      >\n                        Company{getSortIndicator('company_name')}\n                      </th>\n                      <th \n                        onClick={() => handleSort('placedon')} \n                        className=\"sortable-header\"\n                        title=\"Click to sort by Order Date\"\n                      >\n                        Order Date{getSortIndicator('placedon')}\n                      </th>\n                      <th \n                        onClick={() => handleSort('totalvalue')} \n                        className=\"sortable-header\"\n                        title=\"Click to sort by Amount\"\n                      >\n                        Amount{getSortIndicator('totalvalue')}\n                      </th>\n                      <th \n                        onClick={() => handleSort('payment_status')} \n                        className=\"sortable-header\"\n                        title=\"Click to sort by Invoice Status\"\n                      >\n                        Invoice Status{getSortIndicator('payment_status')}\n                      </th>\n                      <th \n                        onClick={() => handleSort('order_status')} \n                        className=\"sortable-header\"\n                        title=\"Click to sort by Order Status\"\n                      >\n                        Order Status{getSortIndicator('order_status')}\n                      </th>\n                      <th \n                        onClick={() => handleSort('shipping_status')} \n                        className=\"sortable-header\"\n                        title=\"Click to sort by Shipping Status\"\n                      >\n                        Shipping Status{getSortIndicator('shipping_status')}\n                      </th>\n                      <th \n                        onClick={() => handleSort('stock_status')} \n                        className=\"sortable-header\"\n                        title=\"Click to sort by Stock Status\"\n                      >\n                        Stock Status{getSortIndicator('stock_status')}\n                      </th>\n                      <th \n                        onClick={() => handleSort('days_outstanding')} \n                        className=\"sortable-header\"\n                        title=\"Click to sort by Days Outstanding\"\n                      >\n                        Days Outstanding{getSortIndicator('days_outstanding')}\n                      </th>\n                      <th>\n                        Notes\n                      </th>\n                      <th>\n                        Payment\n                      </th>\n                      <th>\n                        Email Actions\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {unpaidInvoices.map((invoice) => {\n                      const orderDate = new Date(invoice.orderDate);\n                      const daysOutstanding = invoice.days_outstanding || Math.floor((new Date() - orderDate) / (1000 * 60 * 60 * 24));\n                      \n                      return (\n                        <tr key={invoice.id} className={daysOutstanding > 30 ? 'overdue' : ''}>\n                          <td>\n                            <strong>{invoice.orderNumber || `#${invoice.id}`}</strong>\n                          </td>\n                          <td>\n                            <strong>{invoice.invoiceNumber || 'N/A'}</strong>\n                          </td>\n                          <td>\n                            <strong>{invoice.orderRef || 'N/A'}</strong>\n                          </td>\n                          <td>\n                            <div>\n                              <strong>{invoice.billingContact?.name || invoice.customer.name}</strong>\n                              <br />\n                              <small>{invoice.billingContact?.email || invoice.customer.email}</small>\n                            </div>\n                          </td>\n                          <td>\n                            <div>\n                              <strong>{invoice.deliveryContact?.name || 'Same as Billing'}</strong>\n                              <br />\n                              <small>{invoice.deliveryContact?.email || ''}</small>\n                            </div>\n                          </td>\n                          <td>{invoice.company.name || 'N/A'}</td>\n                          <td>{formatDate(invoice.orderDate)}</td>\n                          <td>\n                            {invoice.paymentStatus?.toLowerCase().includes('partial') && invoice.paidAmount > 0 ? (\n                              <div>\n                                <strong>{formatCurrency(invoice.outstandingAmount)}</strong>\n                                <br />\n                                <small style={{ color: '#6c757d' }}>\n                                  Total: {formatCurrency(invoice.totalAmount)} | \n                                  Paid: {formatCurrency(invoice.paidAmount)}\n                                </small>\n                              </div>\n                            ) : (\n                              <strong>{formatCurrency(invoice.totalAmount)}</strong>\n                            )}\n                          </td>\n                          <td>\n                            <span \n                              className=\"status-badge\" \n                              style={{ backgroundColor: invoice.paymentStatusColor || invoice.statusColor, color: 'white' }}\n                            >\n                              {invoice.paymentStatus}\n                            </span>\n                          </td>\n                          <td>\n                            <span \n                              className=\"status-badge\" \n                              style={{ backgroundColor: invoice.orderStatusColor, color: 'white' }}\n                            >\n                              {invoice.orderStatus}\n                            </span>\n                          </td>\n                          <td>\n                            <span \n                              className=\"status-badge\" \n                              style={{ backgroundColor: invoice.shippingStatusColor, color: 'white' }}\n                            >\n                              {invoice.shippingStatus}\n                            </span>\n                          </td>\n                          <td>\n                            <span \n                              className=\"status-badge\" \n                              style={{ backgroundColor: invoice.stockStatusColor, color: 'white' }}\n                            >\n                              {invoice.stockStatus}\n                            </span>\n                          </td>\n                          <td>\n                            <span className={daysOutstanding > 30 ? 'overdue-days' : 'normal-days'}>\n                              {daysOutstanding} days\n                            </span>\n                          </td>\n                          <td>\n                            <button \n                              className=\"notes-button\"\n                              onClick={() => openNotesModal(invoice)}\n                              title={\n                                (invoice.hasNotes || invoice.hasBrightpearlNotes) \n                                  ? `View ${invoice.notesCount || 0} user note${(invoice.notesCount || 0) !== 1 ? 's' : ''} + ${invoice.brightpearlNotesCount || 0} Brightpearl note${(invoice.brightpearlNotesCount || 0) !== 1 ? 's' : ''}${\n                                      invoice.brightpearlNotes?.some(note => note.fileId) ? ' (includes file attachments)' : ''\n                                    }` \n                                  : 'Add note'\n                              }\n                            >\n                              ðŸ“ \n                              {(invoice.notesCount > 0 || invoice.brightpearlNotesCount > 0) && (\n                                <span className=\"notes-count\">\n                                  {(invoice.notesCount || 0) + (invoice.brightpearlNotesCount || 0)}\n                                </span>\n                              )}\n                              {invoice.hasBrightpearlNotes && (\n                                <span className=\"brightpearl-indicator\" title=\"Has Brightpearl notes\">âœ¨</span>\n                              )}\n                              {invoice.brightpearlNotes?.some(note => note.fileId) && (\n                                <span className=\"attachment-indicator\" title=\"Has file attachments\">ðŸ“Ž</span>\n                              )}\n                            </button>\n                          </td>\n                          <td>\n                            {invoice.hasPaymentLink ? (\n                              <a \n                                href={invoice.paymentLink}\n                                target=\"_blank\"\n                                rel=\"noopener noreferrer\"\n                                className=\"payment-link-button\"\n                                title=\"Open payment link in new tab\"\n                              >\n                                ðŸ’³ Pay Now\n                              </a>\n                            ) : (\n                              <button \n                                className=\"generate-payment-link-button\"\n                                onClick={() => generatePaymentLink(invoice.id)}\n                                title=\"Generate payment link\"\n                              >\n                                ðŸ”— Generate Link\n                              </button>\n                            )}\n                          </td>\n                          <td>\n                            <div className=\"email-actions\">\n                              {userEmailSettings?.google_app_password ? (\n                                <>\n                                  <button \n                                    className=\"email-button invoice-btn\"\n                                    onClick={() => openEmailModal(invoice, 'invoice')}\n                                    title=\"Send invoice email\"\n                                  >\n                                    ðŸ“§ Invoice\n                                  </button>\n                                  <button \n                                    className=\"email-button reminder-btn\"\n                                    onClick={() => openEmailModal(invoice, 'reminder')}\n                                    title=\"Send reminder email\"\n                                  >\n                                    âš ï¸ Reminder\n                                  </button>\n                                </>\n                              ) : (\n                                <div className=\"email-not-configured\">\n                                  <small>Email not configured</small>\n                                </div>\n                              )}\n                            </div>\n                          </td>\n                        </tr>\n                      );\n                    })}\n                  </tbody>\n                </table>\n                \n                <div className=\"table-summary\">\n                  <p>\n                    Showing {unpaidInvoices.length} of {pagination?.total_count?.toLocaleString() || 0} unpaid invoices. \n                    Total outstanding: <strong>\n                      {formatCurrency(unpaidInvoices.reduce((sum, inv) => sum + (inv.outstandingAmount || inv.totalAmount), 0))}\n                    </strong>\n                  </p>\n                </div>\n              </div>\n            )}\n          </>\n        )}\n        \n        {renderPagination()}\n      </div>\n\n      {/* Quick Actions */}\n      <div className=\"quick-actions\">\n        <h3>âš¡ Quick Actions</h3>\n        <div className=\"action-buttons\">\n          <button \n            onClick={() => loadUnpaidInvoices(currentPage, sortConfig)}\n            disabled={isLoading}\n            className=\"btn-primary\"\n          >\n            {isLoading ? 'ðŸ”„ Refreshing...' : 'ðŸ”„ Refresh Invoices'}\n          </button>\n          \n          <button \n            onClick={() => {\n              setDateRange({\n                start: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n                end: new Date().toISOString().split('T')[0]\n              });\n            }}\n            className=\"btn-secondary\"\n          >\n            ðŸ“… Last 30 Days\n          </button>\n          \n          <button \n            onClick={() => {\n              setDateRange({\n                start: new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n                end: new Date().toISOString().split('T')[0]\n              });\n            }}\n            className=\"btn-secondary\"\n          >\n            ðŸ“… Last 90 Days\n          </button>\n        </div>\n      </div>\n\n      {/* Connection Status */}\n      <div className=\"connection-status\">\n        <h3>ðŸ”— System Status</h3>\n        <div className=\"status-grid\">\n          <div className=\"status-item\">\n            <span className=\"status-icon\">âœ…</span>\n            <div>\n              <strong>Database Connection</strong>\n              <br />\n              <small>Connected to Supabase</small>\n            </div>\n          </div>\n          <div className=\"status-item\">\n            <span className=\"status-icon\">âœ…</span>\n            <div>\n              <strong>Brightpearl Data</strong>\n              <br />\n              <small>Real-time invoice data</small>\n            </div>\n          </div>\n          <div className=\"status-item\">\n            <span className=\"status-icon\">âœ…</span>\n            <div>\n              <strong>API Service</strong>\n              <br />\n              <small>All systems operational</small>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Notes Modal */}\n      {notesModal.isOpen && (\n        <div className=\"modal-overlay\" onClick={closeNotesModal}>\n          <div className=\"modal-content\" onClick={(e) => e.stopPropagation()}>\n            <div className=\"modal-header\">\n              <h3>ðŸ“ Notes for Order #{notesModal.invoice?.id}</h3>\n              <button className=\"modal-close\" onClick={closeNotesModal}>Ã—</button>\n            </div>\n            \n            <div className=\"modal-body\">\n              {/* Add new note */}\n              <div className=\"add-note-section\">\n                <textarea\n                  value={notesModal.newNote}\n                  onChange={(e) => setNotesModal(prev => ({ ...prev, newNote: e.target.value }))}\n                  placeholder=\"Add a note for this order...\"\n                  className=\"note-textarea\"\n                  rows=\"3\"\n                />\n                <button \n                  onClick={addNote}\n                  className=\"btn-primary add-note-btn\"\n                  disabled={!notesModal.newNote.trim()}\n                >\n                  Add Note\n                </button>\n              </div>\n\n              {/* Notes sections */}\n              {notesModal.isLoading ? (\n                <div className=\"loading\">Loading notes...</div>\n              ) : (\n                <>\n                  {/* Brightpearl Notes Section */}\n                  {notesModal.brightpearlNotes && notesModal.brightpearlNotes.length > 0 && (\n                    <div className=\"notes-section\">\n                      <h4 className=\"notes-section-title\">\n                        âœ¨ Brightpearl Notes ({notesModal.brightpearlNotes.length})\n                        <small>From Brightpearl system</small>\n                      </h4>\n                      <div className=\"notes-list brightpearl-notes\">\n                        {notesModal.brightpearlNotes.map((note) => (\n                          <div key={`bp-${note.id}`} className=\"note-item brightpearl-note\">\n                            <div className=\"note-content\">\n                              {note.text}\n                              {note.fileId && (\n                                <div className=\"note-attachment\">\n                                  <a \n                                    href={`https://use1.brightpearlapp.com/filestore.php?id=${note.fileId}`}\n                                    target=\"_blank\"\n                                    rel=\"noopener noreferrer\"\n                                    className=\"attachment-link\"\n                                    title=\"View attached file\"\n                                  >\n                                    ðŸ“Ž File Attachment (ID: {note.fileId})\n                                  </a>\n                                </div>\n                              )}\n                            </div>\n                            <div className=\"note-meta\">\n                              <span className=\"note-author\">\n                                Contact ID: {note.contactId} | Added by: {note.addedBy}\n                              </span>\n                              <span className=\"note-date\">\n                                {note.formattedDate}\n                              </span>\n                              <span className=\"note-visibility\">\n                                {note.isPublic ? 'ðŸŒ Public' : 'ðŸ”’ Private'}\n                              </span>\n                              {note.orderStatusId && (\n                                <span className=\"note-status\">\n                                  Status: {note.orderStatusId}\n                                </span>\n                              )}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* User Notes Section */}\n                  <div className=\"notes-section\">\n                    <h4 className=\"notes-section-title\">\n                      ðŸ‘¤ Your Notes ({notesModal.userNotes.length})\n                      <small>Added by portal users</small>\n                    </h4>\n                    <div className=\"notes-list user-notes\">\n                      {notesModal.userNotes.length === 0 ? (\n                        <div className=\"no-notes\">No user notes yet for this order.</div>\n                      ) : (\n                        notesModal.userNotes.map((note) => (\n                          <div key={`user-${note.id}`} className=\"note-item user-note\">\n                            <div className=\"note-content\">{note.note}</div>\n                            <div className=\"note-meta\">\n                              <span className=\"note-author\">\n                                by {note.app_users?.first_name && note.app_users?.last_name \n                                    ? `${note.app_users.first_name} ${note.app_users.last_name}` \n                                    : note.app_users?.email || 'Unknown'}\n                              </span>\n                              <span className=\"note-date\">\n                                {new Date(note.created_at).toLocaleString()}\n                              </span>\n                              <button \n                                onClick={() => deleteNote(note.id)}\n                                className=\"delete-note-btn\"\n                                title=\"Delete note\"\n                              >\n                                ðŸ—‘ï¸\n                              </button>\n                            </div>\n                          </div>\n                        ))\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Show message if no notes at all */}\n                  {(!notesModal.userNotes || notesModal.userNotes.length === 0) && \n                   (!notesModal.brightpearlNotes || notesModal.brightpearlNotes.length === 0) && (\n                    <div className=\"no-notes\">\n                      <p>No notes found for this order.</p>\n                      <small>Add your first note using the form above.</small>\n                    </div>\n                  )}\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Email Modal */}\n      {emailModal.isOpen && (\n        <EmailModal\n          isOpen={emailModal.isOpen}\n          invoice={emailModal.invoice}\n          emailType={emailModal.emailType}\n          onClose={closeEmailModal}\n          onSend={handleSendEmail}\n          token={token}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default InvoiceDashboard;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}